# ML Service (Python)

–°–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 3D-–º–æ–¥–µ–ª–µ–π.

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

*   **–Ø–∑—ã–∫:** Python 3.9
*   **–í—Ö–æ–¥:** Apache Kafka (`modelforge.generation.requests`)
*   **–í—ã—Ö–æ–¥:** PostgreSQL (—Å—Ç–∞—Ç—É—Å—ã), MinIO (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã)


## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `docker-compose.yml`):

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `KAFKA_BOOTSTRAP_SERVERS` | –ê–¥—Ä–µ—Å Kafka | `kafka:9092` |
| `DATABASE_URL` | Connection string –ë–î | `postgresql://...` |
| `S3_ENDPOINT` | –ê–¥—Ä–µ—Å MinIO | `minio:9000` |
| `ML_MOCK_MODE` | –†–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏ | `true` / `false` |
| `TRIPSR_DEVICE` | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è ML | `cpu` / `cuda:0` |

## üß™ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç—ã

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞
PYTHONPATH=src python -m modelforge.worker.main
```

### Unit-—Ç–µ—Å—Ç—ã
```bash
PYTHONPATH=src pytest tests/ -v
```

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ (TripoSR)

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Strategy. –ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å:

1.  –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ModelInferenceInterface` –≤ —Ñ–∞–π–ª–µ `ml/tripors_service.py`.
2.  –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–±—Ä–∏–∫—É `ml/factory.py`, –¥–æ–±–∞–≤–∏–≤ –≤–æ–∑–≤—Ä–∞—Ç –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
3.  –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥ `ML_MOCK_MODE=false`.
